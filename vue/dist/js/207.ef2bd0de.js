"use strict";(self["webpackChunkweb_vue"]=self["webpackChunkweb_vue"]||[]).push([[207],{3207:function(e,a,t){t.r(a),t.d(a,{default:function(){return x}});var r=t(6768);const o={class:"product-list-view"},i={class:"container py-4"},s={class:"row"},n={class:"col-md-3 d-none d-md-block"},c={class:"col-12 col-md-9"};function u(e,a,t,u,d,l){const g=(0,r.g2)("category-sidebar"),m=(0,r.g2)("product-list-component");return(0,r.uX)(),(0,r.CE)("div",o,[(0,r.Lk)("div",i,[(0,r.Lk)("div",s,[(0,r.Lk)("div",n,[(0,r.bF)(g,{"main-category-id":t.mainCategoryId,"sub-category-id":t.subCategoryId},null,8,["main-category-id","sub-category-id"])]),(0,r.Lk)("div",c,[(0,r.bF)(m,{"main-category-id":t.mainCategoryId,"sub-category-id":t.subCategoryId},null,8,["main-category-id","sub-category-id"])])])])])}var d=t(4232),l=t(2942);const g={class:"product-list-container"},m={class:"category-title mb-4"},y={key:0,class:"alert alert-danger"},C={key:1,class:"row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4"},b=["onClick"],v={class:"product-image-container"},p=["src","alt"],I=["src","alt"],f={key:2,src:l,class:"card-img-top product-image",alt:"預設產品圖片"},k={class:"card-body"},h={class:"card-title"},S={class:"card-text model"},E={key:0,class:"card-text price"},w={class:"card-text description"},N={key:2,class:"no-products-message"};function _(e,a,t,o,i,s){const n=(0,r.g2)("breadcrumb-component"),c=(0,r.g2)("loading-component");return(0,r.uX)(),(0,r.CE)("div",g,[(0,r.bF)(n,{"main-category-id":o.foundMainCategoryId||t.mainCategoryId,"main-category-name":o.mainCategoryName,"sub-category-id":t.subCategoryId,"sub-category-name":o.subCategoryName},null,8,["main-category-id","main-category-name","sub-category-id","sub-category-name"]),(0,r.Lk)("h2",m,(0,d.v_)(o.pageTitle),1),(0,r.bF)(c,{show:o.loading,message:"載入產品中..."},null,8,["show"]),o.error?((0,r.uX)(),(0,r.CE)("div",y,(0,d.v_)(o.error),1)):(0,r.Q3)("",!0),o.products.length>0?((0,r.uX)(),(0,r.CE)("div",C,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.products,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"col"},[(0,r.Lk)("div",{class:"card h-100 product-card",onClick:a=>o.goToProductDetail(e.id)},[(0,r.Lk)("div",v,[e.image_url?((0,r.uX)(),(0,r.CE)("img",{key:0,src:e.image_url,class:"card-img-top product-image",alt:e.name,onError:a[0]||(a[0]=(...e)=>o.handleImageError&&o.handleImageError(...e))},null,40,p)):e.has_image&&e.image_id?((0,r.uX)(),(0,r.CE)("img",{key:1,src:o.getProductImage(e.image_id),class:"card-img-top product-image",alt:e.name,onError:a[1]||(a[1]=(...e)=>o.handleImageError&&o.handleImageError(...e))},null,40,I)):((0,r.uX)(),(0,r.CE)("img",f))]),(0,r.Lk)("div",k,[(0,r.Lk)("h5",h,(0,d.v_)(e.name),1),(0,r.Lk)("p",S,"型號: "+(0,d.v_)(e.model||"N/A"),1),e.price?((0,r.uX)(),(0,r.CE)("p",E,"價格: NT$ "+(0,d.v_)(o.formatPrice(e.price)),1)):(0,r.Q3)("",!0),(0,r.Lk)("p",w,(0,d.v_)(o.truncateDescription(e.description)),1)])],8,b)])))),128))])):o.loading||o.error?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",N,a[2]||(a[2]=[(0,r.Lk)("p",null,"此分類下暫無產品",-1)])))])}t(4114),t(8111),t(116);var X=t(144),L=t(782),A=t(1387),P=t(4708),W=t(5480),F=t(1524),K={name:"ProductListComponent",components:{LoadingComponent:P.A,BreadcrumbComponent:W.A},props:{mainCategoryId:{type:[Number,String],default:null},subCategoryId:{type:[Number,String],default:null}},setup(e){const a=(0,L.Pj)(),o=(0,A.rd)(),i=(0,X.KR)([]),s=(0,r.EW)((()=>a.getters["products/loading"])),n=(0,r.EW)((()=>a.getters["products/error"])),c=(0,X.KR)(""),u=(0,X.KR)(""),d=(0,X.KR)(null),l=(0,r.EW)((()=>u.value?u.value:c.value?c.value:"產品列表")),g=async()=>{try{if(e.subCategoryId){const t=await a.dispatch("products/fetchProductsBySubCategory",e.subCategoryId);i.value=t,await m()}else if(e.mainCategoryId){const t=await a.dispatch("products/fetchProductsByMainCategory",e.mainCategoryId);i.value=t,await m()}else i.value=[],c.value="",u.value="",d.value=null}catch(n){console.error("載入產品失敗:",n)}},m=async()=>{try{if(0===a.getters["categories/mainCategories"].length&&await a.dispatch("categories/fetchMainCategories"),c.value="",u.value="",d.value=null,e.subCategoryId){const t=a.getters["categories/mainCategories"];for(const r of t){const t=await a.dispatch("categories/fetchSubCategories",r.id),o=t.find((a=>a.id.toString()===e.subCategoryId.toString()));if(o){d.value=r.id,c.value=r.name,u.value=o.name;break}}}else if(e.mainCategoryId){const t=a.getters["categories/mainCategories"],r=t.find((a=>a.id.toString()===e.mainCategoryId.toString()));r&&(d.value=r.id,c.value=r.name)}}catch(n){console.error("載入分類信息失敗:",n)}},y=e=>F.A.getProductImage(e),C=e=>{console.warn("圖片載入失敗，使用預設圖片:",e.target.src),e.target.src=t(2942)},b=e=>Number(e).toLocaleString("zh-TW"),v=e=>e?e.length>100?e.substring(0,100)+"...":e:"",p=e=>{o.push({name:"productDetail",params:{productId:e}})};return(0,r.wB)((()=>[e.mainCategoryId,e.subCategoryId]),(()=>{g()}),{immediate:!0}),(0,r.sV)((()=>{g()})),{products:i,loading:s,error:n,mainCategoryName:c,subCategoryName:u,foundMainCategoryId:d,pageTitle:l,getProductImage:y,handleImageError:C,formatPrice:b,truncateDescription:v,goToProductDetail:p}}},M=t(1241);const Q=(0,M.A)(K,[["render",_],["__scopeId","data-v-45922f6e"]]);var B=Q,R=t(4663),T={name:"ProductListView",components:{ProductListComponent:B,CategorySidebar:R.A},props:{mainCategoryId:{type:[Number,String],default:null},subCategoryId:{type:[Number,String],default:null}}};const D=(0,M.A)(T,[["render",u]]);var x=D},4663:function(e,a,t){t.d(a,{A:function(){return y}});var r=t(6768),o=t(4232);const i={class:"category-sidebar"},s={class:"category-menu"},n={key:0,class:"sub-category-menu"};function c(e,a,t,c,u,d){const l=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",i,[a[0]||(a[0]=(0,r.Lk)("h5",{class:"sidebar-title"},"產品介紹",-1)),(0,r.Lk)("ul",s,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c.mainCategories,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id,class:(0,o.C4)({active:c.isMainCategoryActive(e.id)})},[(0,r.bF)(l,{to:{name:"mainCategory",params:{mainCategoryId:e.id}},class:(0,o.C4)({"active-link":c.isMainCategoryActive(e.id)})},{default:(0,r.k6)((()=>[(0,r.eW)((0,o.v_)(e.name),1)])),_:2},1032,["to","class"]),c.shouldShowSubCategories(e.id)?((0,r.uX)(),(0,r.CE)("ul",n,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c.getCategorySubItems(e.id),(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id,class:(0,o.C4)({active:c.isSubCategoryActive(e.id)})},[(0,r.bF)(l,{to:{name:"subCategory",params:{subCategoryId:e.id}},class:(0,o.C4)({"active-link":c.isSubCategoryActive(e.id)})},{default:(0,r.k6)((()=>[(0,r.eW)((0,o.v_)(e.name),1)])),_:2},1032,["to","class"])],2)))),128))])):(0,r.Q3)("",!0)],2)))),128))])])}t(8111),t(116);var u=t(144),d=t(782),l={name:"CategorySidebar",props:{mainCategoryId:{type:[Number,String],default:null},subCategoryId:{type:[Number,String],default:null}},setup(e){const a=(0,d.Pj)(),t=(0,r.EW)((()=>a.getters["categories/mainCategories"])),o=(0,u.KR)({}),i=(0,u.KR)(null),s=async()=>{0===t.value.length&&await a.dispatch("categories/fetchMainCategories")},n=async()=>{try{0===t.value.length&&await s();for(const e of t.value){const t=await a.dispatch("categories/fetchSubCategories",e.id);o.value[e.id]=t}}catch(e){console.error("載入子分類失敗:",e)}},c=async()=>{if(e.subCategoryId&&!i.value)for(const r of t.value){const t=o.value[r.id]||await a.dispatch("categories/fetchSubCategories",r.id);o.value[r.id]||(o.value[r.id]=t);const s=t.find((a=>a.id.toString()===e.subCategoryId.toString()));if(s){i.value=r.id,console.log("找到子分類所屬主分類:",r.id,r.name);break}}else e.mainCategoryId&&(i.value=e.mainCategoryId)},l=e=>!!m(e)||e.toString()===(i.value||"").toString(),g=e=>o.value[e]||[],m=a=>a.toString()===(e.mainCategoryId||"").toString(),y=a=>a.toString()===(e.subCategoryId||"").toString();return(0,r.wB)([()=>e.mainCategoryId,()=>e.subCategoryId],(async()=>{if(e.mainCategoryId){if(i.value=e.mainCategoryId,!o.value[e.mainCategoryId]){const t=await a.dispatch("categories/fetchSubCategories",e.mainCategoryId);o.value[e.mainCategoryId]=t}}else e.subCategoryId?await c():i.value=null}),{immediate:!0}),(0,r.sV)((async()=>{await s(),await n(),e.subCategoryId&&await c()})),{mainCategories:t,shouldShowSubCategories:l,getCategorySubItems:g,isMainCategoryActive:m,isSubCategoryActive:y}}},g=t(1241);const m=(0,g.A)(l,[["render",c],["__scopeId","data-v-33a32ee1"]]);var y=m},5480:function(e,a,t){t.d(a,{A:function(){return C}});var r=t(6768),o=t(4232);const i={"aria-label":"breadcrumb",class:"mb-4"},s={class:"breadcrumb"},n={class:"breadcrumb-item"},c={key:1},u={key:1},d={key:2,class:"breadcrumb-item active"};function l(e,a,t,l,g,m){const y=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("nav",i,[(0,r.Lk)("ol",s,[(0,r.Lk)("li",n,[(0,r.bF)(y,{to:"/"},{default:(0,r.k6)((()=>a[0]||(a[0]=[(0,r.eW)("首頁")]))),_:1})]),t.mainCategoryName?((0,r.uX)(),(0,r.CE)("li",{key:0,class:(0,o.C4)(["breadcrumb-item",{active:!t.subCategoryName&&!t.itemName}])},[(t.subCategoryName||t.itemName)&&t.mainCategoryId?((0,r.uX)(),(0,r.Wv)(y,{key:0,to:{name:"mainCategory",params:{mainCategoryId:t.mainCategoryId}}},{default:(0,r.k6)((()=>[(0,r.eW)((0,o.v_)(t.mainCategoryName),1)])),_:1},8,["to"])):((0,r.uX)(),(0,r.CE)("span",c,(0,o.v_)(t.mainCategoryName),1))],2)):(0,r.Q3)("",!0),t.subCategoryName?((0,r.uX)(),(0,r.CE)("li",{key:1,class:(0,o.C4)(["breadcrumb-item",{active:!t.itemName}])},[t.itemName&&t.subCategoryId?((0,r.uX)(),(0,r.Wv)(y,{key:0,to:{name:"subCategory",params:{subCategoryId:t.subCategoryId}}},{default:(0,r.k6)((()=>[(0,r.eW)((0,o.v_)(t.subCategoryName),1)])),_:1},8,["to"])):((0,r.uX)(),(0,r.CE)("span",u,(0,o.v_)(t.subCategoryName),1))],2)):(0,r.Q3)("",!0),t.itemName?((0,r.uX)(),(0,r.CE)("li",d,(0,o.v_)(t.itemName),1)):(0,r.Q3)("",!0)])])}var g={name:"BreadcrumbComponent",props:{mainCategoryId:{type:[Number,String],default:null},mainCategoryName:{type:String,default:""},subCategoryId:{type:[Number,String],default:null},subCategoryName:{type:String,default:""},itemName:{type:String,default:""}}},m=t(1241);const y=(0,m.A)(g,[["render",l],["__scopeId","data-v-251d43c5"]]);var C=y}}]);